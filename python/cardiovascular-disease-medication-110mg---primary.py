# Caroline E Dale, Rohan Takhar, et. al, 2024.

import sys, csv, re

codes = [{"code":"0204000H0BGABAB","system":"bnf"},{"code":"0202040B0AAACAC","system":"bnf"},{"code":"0205051Y0AAACAC","system":"bnf"},{"code":"0206020F0BEABAC","system":"bnf"},{"code":"0205051R0BBAIAN","system":"bnf"},{"code":"0205051W0BBAAAA","system":"bnf"},{"code":"0205030H0AAAAAA","system":"bnf"},{"code":"0206020F0BHABAC","system":"bnf"},{"code":"0205052ACBBAEAE","system":"bnf"},{"code":"0204000R0BZACAH","system":"bnf"},{"code":"0204000R0BDAGAH","system":"bnf"},{"code":"0205051K0BEAAAB","system":"bnf"},{"code":"0206020F0BKABAC","system":"bnf"},{"code":"0206020F0AAACAC","system":"bnf"},{"code":"0205051Q0AAABAB","system":"bnf"},{"code":"0206020W0AAAAAA","system":"bnf"},{"code":"0206020R0BBAGAE","system":"bnf"},{"code":"0205052ABBBACAC","system":"bnf"},{"code":"0205051L0BCACAC","system":"bnf"},{"code":"0205051I0BBACAC","system":"bnf"},{"code":"0205052ACBBACAC","system":"bnf"},{"code":"0206020A0AAABAB","system":"bnf"},{"code":"0205051P0BBAAAA","system":"bnf"},{"code":"0205040M0BBAAAC","system":"bnf"},{"code":"0204000H0BCABAB","system":"bnf"},{"code":"0205052ACAAACAC","system":"bnf"},{"code":"0206020F0BFABAC","system":"bnf"},{"code":"0205051J0BBAAAA","system":"bnf"},{"code":"0205051Q0BBABAB","system":"bnf"},{"code":"0205051R0AAADAD","system":"bnf"},{"code":"0205010J0BCAABK","system":"bnf"},{"code":"0205051L0BBACAC","system":"bnf"},{"code":"0204000R0AAAHAH","system":"bnf"},{"code":"0205051J0AAAAAA","system":"bnf"},{"code":"0206020F0BBABAC","system":"bnf"},{"code":"0205051L0AAACAC","system":"bnf"},{"code":"0204000H0AAABAB","system":"bnf"},{"code":"0205040V0AAADAD","system":"bnf"},{"code":"0206020L0AAAAAA","system":"bnf"},{"code":"0206020F0BDACAC","system":"bnf"},{"code":"0205051ACAAACAC","system":"bnf"},{"code":"0205051K0BDAAAB","system":"bnf"},{"code":"0205051W0AAAAAA","system":"bnf"},{"code":"0206020F0BIAFAC","system":"bnf"},{"code":"0206020F0BMAAAC","system":"bnf"},{"code":"0205051P0AAAAAA","system":"bnf"},{"code":"0206020R0AAAMAM","system":"bnf"},{"code":"0205040M0AAACAC","system":"bnf"},{"code":"0205010AAAAAAAA","system":"bnf"},{"code":"0206020R0AAABAB","system":"bnf"},{"code":"0205051R0BCACAD","system":"bnf"},{"code":"0206020R0BHAEAE","system":"bnf"},{"code":"0205052B0AAAAAA","system":"bnf"},{"code":"0206020R0BGABAM","system":"bnf"},{"code":"0205051K0AAABAB","system":"bnf"},{"code":"0206020R0BBABAB","system":"bnf"},{"code":"0204000H0BJABAB","system":"bnf"},{"code":"0206020Z0AAACAC","system":"bnf"},{"code":"0206020A0BBABAB","system":"bnf"},{"code":"0204000V0BBAAAA","system":"bnf"},{"code":"0205051K0BFABAB","system":"bnf"},{"code":"0206020L0BBAAAA","system":"bnf"},{"code":"0205051R0BBADAD","system":"bnf"},{"code":"0206020F0BIABAC","system":"bnf"},{"code":"0202040S0AAANAN","system":"bnf"},{"code":"0206020F0BGABAC","system":"bnf"},{"code":"0204000H0BIABAB","system":"bnf"},{"code":"0206020R0BLABAE","system":"bnf"},{"code":"0206020A0BFABAB","system":"bnf"},{"code":"0205010J0AABKBK","system":"bnf"},{"code":"0205040V0BBADAD","system":"bnf"},{"code":"0204000V0AAAAAA","system":"bnf"},{"code":"0202040S0AAAAAA","system":"bnf"},{"code":"0204000H0BBABAB","system":"bnf"},{"code":"0204000R0BWAAAH","system":"bnf"},{"code":"0202040B0BBACAC","system":"bnf"},{"code":"0206020F0BJABAC","system":"bnf"},{"code":"0205051ACAAABAB","system":"bnf"},{"code":"0205051L0BEACAC","system":"bnf"},{"code":"0206020Z0BBACAC","system":"bnf"},{"code":"0204000H0BFAFAB","system":"bnf"},{"code":"0206020F0BLABAC","system":"bnf"},{"code":"0205052ABAAACAC","system":"bnf"},{"code":"0205051I0AAACAC","system":"bnf"},{"code":"0205010N0AAACAC","system":"bnf"},{"code":"0206020F0BIADAC","system":"bnf"},{"code":"0205051R0AAANAN","system":"bnf"},{"code":"0206020R0AAAEAE","system":"bnf"},{"code":"0204000R0BGAAAH","system":"bnf"},{"code":"0205051AAAAACAC","system":"bnf"},{"code":"0205010N0BBACAC","system":"bnf"},{"code":"0206020R0BQACAE","system":"bnf"},{"code":"0205051Q0BCABAB","system":"bnf"},{"code":"0205052ACAAAEAE","system":"bnf"},{"code":"0205051Y0BBACAC","system":"bnf"},{"code":"0205052B0BBAAAA","system":"bnf"},{"code":"0209000Y0BBABAB","system":"bnf"},{"code":"0209000Y0AAABAB","system":"bnf"},{"code":"0209000Y0BCABAB","system":"bnf"},{"code":"0208020Y0AAAAAA","system":"bnf"},{"code":"0208020X0AAABAB","system":"bnf"},{"code":"0208020X0BBABAB","system":"bnf"},{"code":"0208020Y0BBAAAA","system":"bnf"},{"code":"0208020N0AAAAAA","system":"bnf"},{"code":"0212000L0AAAAAA","system":"bnf"},{"code":"0212000AFAAABAB","system":"bnf"},{"code":"0212000ACBBABAB","system":"bnf"},{"code":"0212000ACAAACAC","system":"bnf"},{"code":"0212000Y0BFAAAA","system":"bnf"},{"code":"0212000AFBBABAB","system":"bnf"},{"code":"0212000Y0BBAEAA","system":"bnf"},{"code":"0212000X0BBAAAA","system":"bnf"},{"code":"0212000B0AAAAAA","system":"bnf"},{"code":"0212000Y0AAAAAA","system":"bnf"},{"code":"0212000Y0BDAAAA","system":"bnf"},{"code":"0212000Y0BBAAAA","system":"bnf"},{"code":"0212000L0BBAAAA","system":"bnf"},{"code":"0212000B0BBAAAA","system":"bnf"},{"code":"0212000ACBBAAAA","system":"bnf"},{"code":"0212000ACAAABAB","system":"bnf"},{"code":"0212000ACAAAAAA","system":"bnf"},{"code":"0212000AABBAAAA","system":"bnf"},{"code":"0212000ACBBACAC","system":"bnf"},{"code":"0212000B0BBAEAL","system":"bnf"},{"code":"0212000ALBBAAAA","system":"bnf"},{"code":"0212000B0AAALAL","system":"bnf"},{"code":"0212000X0AAAAAA","system":"bnf"},{"code":"0212000Y0BEAAAA","system":"bnf"},{"code":"0212000AAAAAAAA","system":"bnf"},{"code":"0601023AGAAABAB","system":"bnf"},{"code":"0601023ANAAAAAA","system":"bnf"},{"code":"020400090AAAAAA","system":"bnf"},{"code":"0204000ABAAACAC","system":"bnf"},{"code":"0202020U0BBACAC","system":"bnf"},{"code":"0202020U0AAACAC","system":"bnf"},{"code":"0206010I0AAADAD","system":"bnf"},{"code":"0206030N0AAAAAA","system":"bnf"},{"code":"0206010K0BEABAB","system":"bnf"},{"code":"0206010F0AACLCL","system":"bnf"},{"code":"0206010K0AAABAB","system":"bnf"},{"code":"0206010F0BJACAQ","system":"bnf"},{"code":"0206010F0AAAQAQ","system":"bnf"},{"code":"0206010I0AAACAC","system":"bnf"},{"code":"0206010I0BLABAD","system":"bnf"},{"code":"0206010K0BUAAAB","system":"bnf"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('cardiovascular-disease-medication-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["cardiovascular-disease-medication-110mg---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["cardiovascular-disease-medication-110mg---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["cardiovascular-disease-medication-110mg---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
